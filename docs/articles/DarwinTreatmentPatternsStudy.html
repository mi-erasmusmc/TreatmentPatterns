<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Perform a Darwin study using the TreatmentPatterns package • TreatmentPatterns</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Perform a Darwin study using the TreatmentPatterns package">
<meta property="og:description" content="TreatmentPatterns">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TreatmentPatterns</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DarwinTreatmentPatternsStudy.html">Perform a Darwin study using the TreatmentPatterns package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Perform a Darwin study using the
TreatmentPatterns package</h1>
            
      
      
      <div class="hidden name"><code>DarwinTreatmentPatternsStudy.Rmd</code></div>

    </div>

    
    
<p>In this vignette we will use an example describing the treatment
patterns of <a href="https://atlas-demo.ohdsi.org/#/cohortdefinition/1781027" class="external-link">viral
sinusitis</a> patients. The included drugs of interests are <a href="https://atlas-demo.ohdsi.org/#/cohortdefinition/1781028" class="external-link">Acetaminophen</a>,
<a href="https://atlas-demo.ohdsi.org/#/cohortdefinition/1781029" class="external-link">Amoxicillin</a>,
<a href="https://atlas-demo.ohdsi.org/#/cohortdefinition/1781030" class="external-link">Aspirin</a>,
<a href="https://atlas-demo.ohdsi.org/#/cohortdefinition/1781031" class="external-link">Clavulanate</a>,
<a href="https://atlas-demo.ohdsi.org/#/cohortdefinition/1781033" class="external-link">Doxylamine</a>,
and <a href="https://atlas-demo.ohdsi.org/#/cohortdefinition/1781032" class="external-link">Penicillin
V</a>. These examples are provided in the package and will run in
Eunomia.</p>
<div class="section level2">
<h2 id="installation-of-treatmentpatterns">1. Installation of TreatmentPatterns<a class="anchor" aria-label="anchor" href="#installation-of-treatmentpatterns"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>See the instructions <a href="https://ohdsi.github.io/Hades/rSetup.html" class="external-link">here</a> for
configuring your R environment, including RTools and Java.</p></li>
<li><p>In R, use the following commands to download and install
TreatmentPatterns:</p></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"darwin-eu-dev/TreatmentPatterns"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assumed-prerequisites">2. Assumed prerequisites<a class="anchor" aria-label="anchor" href="#assumed-prerequisites"></a>
</h2>
<p>For this vignette we assume that you are familiar with the
following:</p>
<ol style="list-style-type: decimal">
<li><p>Defining cohorts using i.e. <a href="https://atlas-demo.ohdsi.org/" class="external-link">Atlas</a> or <a href="https://ohdsi.github.io/Capr/" class="external-link">Capr</a></p></li>
<li><p>Access to a CDM database. For this example we will use <a href="https://ohdsi.github.io/Eunomia/" class="external-link">Eunomia</a>.</p></li>
<li><p>Familiarity with generating cohorts in a CDM using <a href="https://ohdsi.github.io/CohortGenerator/" class="external-link">CohortGenerator</a></p></li>
</ol>
<p>In this vignette we will make use of the following packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">TreatmentPatterns</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortGenerator/" class="external-link">CohortGenerator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OHDSI/Eunomia" class="external-link">Eunomia</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CirceR" class="external-link">CirceR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tools</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="viral-sinusitis-cohort-parameters">Viral Sinusitis Cohort parameters<a class="anchor" aria-label="anchor" href="#viral-sinusitis-cohort-parameters"></a>
</h3>
<p>The following text is an export of ATLAS Version 2.12.2. The bold
parts of the text are parameters set in the cohort definition.
TreatmentPatterns expects that the cohort exit is set to <em>continuous
observation</em>.</p>
<div class="section level4">
<h4 id="cohort-entry-events">Cohort Entry Events<a class="anchor" aria-label="anchor" href="#cohort-entry-events"></a>
</h4>
<p>People with continuous observation of <strong>365</strong> days
before and <strong>1,095</strong> days after event may enter the cohort
when observing any of the following:</p>
<p>drug eras of <strong>‘[MVK] Viral Sinusistis drugs’</strong>. Limit
cohort entry events to the <strong>earliest event</strong> per
person.</p>
</div>
<div class="section level4">
<h4 id="inclusion-criteria">Inclusion Criteria<a class="anchor" aria-label="anchor" href="#inclusion-criteria"></a>
</h4>
<p><strong>1. Viral Sinusitis diagnosis</strong> Entry events having at
least 1 condition occurrence of ‘[MVK] Viral Sinusitis diagnosis’, allow
events outside observation period.</p>
<p><strong>2. Index year</strong> Entry events with the following event
criteria: starting after December 31, 1949.</p>
</div>
<div class="section level4">
<h4 id="cohort-exit">Cohort Exit<a class="anchor" aria-label="anchor" href="#cohort-exit"></a>
</h4>
<p>The person exits the cohort at the end of <strong>continuous
observation</strong>.</p>
</div>
<div class="section level4">
<h4 id="cohort-eras">Cohort Eras<a class="anchor" aria-label="anchor" href="#cohort-eras"></a>
</h4>
<p>Entry events will be combined into cohort eras if they are within
<strong>0</strong> days of each other.</p>
</div>
<div class="section level4">
<h4 id="appendix-1-concept-set-definitions">Appendix 1: Concept Set Definitions<a class="anchor" aria-label="anchor" href="#appendix-1-concept-set-definitions"></a>
</h4>
<table class="table">
<colgroup>
<col width="14%">
<col width="23%">
<col width="8%">
<col width="14%">
<col width="11%">
<col width="16%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">Concept Id</th>
<th align="right">Concept Name</th>
<th align="right">Domain</th>
<th align="right">Vocabulary</th>
<th align="right">Excluded</th>
<th align="right">Descendants</th>
<th align="right">Mapped</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1125315</td>
<td align="right">acetaminophen</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="even">
<td align="right">1713332</td>
<td align="right">amoxicillin</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="odd">
<td align="right">1112807</td>
<td align="right">aspirin</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="even">
<td align="right">1759842</td>
<td align="right">clavulanate</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="odd">
<td align="right">1729720</td>
<td align="right">penicillin V</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="even">
<td align="right">738818</td>
<td align="right">doxylamine</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="odd">
<td align="right">738818</td>
<td align="right">doxylamine</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="even">
<td align="right">1119510</td>
<td align="right">dextromethorphan</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="odd">
<td align="right">1177480</td>
<td align="right">ibuprofen</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="even">
<td align="right">1118084</td>
<td align="right">celecoxib</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
<tr class="odd">
<td align="right">1115008</td>
<td align="right">naproxen</td>
<td align="right">Drug</td>
<td align="right">RxNorm</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr>
</tbody>
</table>
<p><em>[MVK] Viral Sinusistis drugs</em></p>
<table style="width:100%;" class="table">
<colgroup>
<col width="14%">
<col width="21%">
<col width="13%">
<col width="14%">
<col width="11%">
<col width="15%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">Concept Id</th>
<th align="right">Concept Name</th>
<th align="right">Domain</th>
<th align="right">Vocabulary</th>
<th align="right">Excluded</th>
<th align="right">Descendants</th>
<th align="right">Mapped</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">40481087</td>
<td align="right">Viral sinusitis</td>
<td align="right">Condition</td>
<td align="right">SNOMED</td>
<td align="right">NO</td>
<td align="right">NO</td>
<td align="right">NO</td>
</tr></tbody>
</table>
<p><em>[MVK] Viral Sinusitis diagnosis</em></p>
</div>
</div>
<div class="section level3">
<h3 id="generating-cohorts">Generating cohorts<a class="anchor" aria-label="anchor" href="#generating-cohorts"></a>
</h3>
<p>To make it easier on our selves later on, we will already specify
some parameters that we will reuse later using TreatmentPatterns.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">Eunomia</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Eunomia/man/getEunomiaConnectionDetails.html" class="external-link">getEunomiaConnectionDetails</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cdmDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"main"</span></span>
<span><span class="va">resultSchema</span> <span class="op">&lt;-</span> <span class="st">"main"</span></span>
<span><span class="va">cohortTable</span> <span class="op">&lt;-</span> <span class="st">"cohortTable"</span></span></code></pre></div>
<p>To generate cohorts using CohortGenerator we can follow the
instructions specified in the vignette:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortsToCreate</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/createEmptyCohortDefinitionSet.html" class="external-link">createEmptyCohortDefinitionSet</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get json-files included with TreatmentPatterns</span></span>
<span><span class="va">cohortJsonFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  package <span class="op">=</span> <span class="st">"TreatmentPatterns"</span>,</span>
<span>  <span class="st">"examples"</span>, <span class="st">"CDM"</span>, <span class="st">"cohorts"</span>, <span class="st">"ViralSinusitis"</span>, <span class="st">"JSON"</span><span class="op">)</span>,</span>
<span>  full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add cohort definition per file</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cohortJsonFiles</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cohortJsonFileName</span> <span class="op">&lt;-</span> <span class="va">cohortJsonFiles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">cohortName</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">cohortJsonFileName</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Here we read in the JSON in order to create the SQL</span></span>
<span>  <span class="co"># using [CirceR](https://ohdsi.github.io/CirceR/)</span></span>
<span>  <span class="co"># If you have your JSON and SQL stored differenly, you can</span></span>
<span>  <span class="co"># modify this to read your JSON/SQL files however you require</span></span>
<span>  <span class="va">cohortJson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readChar.html" class="external-link">readChar</a></span><span class="op">(</span><span class="va">cohortJsonFileName</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span></span>
<span>    <span class="va">cohortJsonFileName</span><span class="op">)</span><span class="op">$</span><span class="va">size</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">cohortExpression</span> <span class="op">&lt;-</span> <span class="fu">CirceR</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CirceR/reference/cohortExpressionFromJson.html" class="external-link">cohortExpressionFromJson</a></span><span class="op">(</span><span class="va">cohortJson</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">cohortSql</span> <span class="op">&lt;-</span> <span class="fu">CirceR</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CirceR/reference/buildCohortQuery.html" class="external-link">buildCohortQuery</a></span><span class="op">(</span></span>
<span>    <span class="va">cohortExpression</span>,</span>
<span>    options <span class="op">=</span> <span class="fu">CirceR</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CirceR/reference/createGenerateOptions.html" class="external-link">createGenerateOptions</a></span><span class="op">(</span>generateStats <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">cohortsToCreate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="va">cohortsToCreate</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      cohortId <span class="op">=</span> <span class="va">i</span>,</span>
<span>      cohortName <span class="op">=</span> <span class="va">cohortName</span>,</span>
<span>      sql <span class="op">=</span> <span class="va">cohortSql</span>,</span>
<span>      stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now that we have specified our cohorts we can generate them.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the cohort tables to hold the cohort generation results</span></span>
<span><span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/getCohortTableNames.html" class="external-link">getCohortTableNames</a></span><span class="op">(</span></span>
<span>  cohortTable <span class="op">=</span> <span class="va">cohortTable</span><span class="op">)</span></span></code></pre></div>
<p>Generate our cohortTableNames</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/createCohortTables.html" class="external-link">createCohortTables</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="va">resultSchema</span>,</span>
<span>  cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can generate our specified cohorts in Eunomia.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate the cohorts</span></span>
<span><span class="va">cohortsGenerated</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/generateCohortSet.html" class="external-link">generateCohortSet</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="va">resultSchema</span>,</span>
<span>  cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,</span>
<span>  cohortDefinitionSet <span class="op">=</span> <span class="va">cohortsToCreate</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="specify-settings-to-construct-treatment-pathways">3. Specify settings to construct treatment pathways<a class="anchor" aria-label="anchor" href="#specify-settings-to-construct-treatment-pathways"></a>
</h2>
<div class="section level3">
<h3 id="datasettings">dataSettings<a class="anchor" aria-label="anchor" href="#datasettings"></a>
</h3>
<p>Note that for specifying our dataSettings we are re-uing are
pre-specified parameters.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDataSettings.html">createDataSettings</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>, <span class="co"># Eunomia connectionDetails</span></span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>, <span class="co"># "main"</span></span>
<span>  resultSchema <span class="op">=</span> <span class="va">resultSchema</span>,           <span class="co"># "main"</span></span>
<span>  cohortTable <span class="op">=</span> <span class="va">cohortTable</span><span class="op">)</span>             <span class="co"># "cohortTable"</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<strong>connectionDetails</strong>: <em>connectionDetails</em>
object of DatabaseConnector (&gt;= 6.0.0).</li>
<li>
<strong>cdmDatabaseSchema</strong>: A character string specifying
the database schema where the CDM is located.</li>
<li>
<strong>resultSchema</strong>: A character string specifying the
database schema where the results in the database should be
written.</li>
<li>
<strong>cohortTable</strong>: A character string specifying the name
of the cohort table.</li>
</ol>
</div>
<div class="section level3">
<h3 id="savesettings">saveSettings<a class="anchor" aria-label="anchor" href="#savesettings"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">saveSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSaveSettings.html">createSaveSettings</a></span><span class="op">(</span></span>
<span>  databaseName <span class="op">=</span> <span class="st">"Eunomia"</span>,</span>
<span>  rootFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  outputFolder <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<strong>databaseName</strong>: Character string specifying the name
of the database.</li>
<li>
<strong>rootFolder</strong>: Character string specifying the path of
the root folder where outputted files should be saved at.</li>
<li>
<strong>outputFolder</strong>: Character string specifying the name
of the folder name the outputted files should be saved in.</li>
</ol>
</div>
<div class="section level3">
<h3 id="createcohortsettings">createCohortSettings<a class="anchor" aria-label="anchor" href="#createcohortsettings"></a>
</h3>
<p>We can make use of the tables generated by CohortGenerator to get
information about our cohorts.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select Viral Sinusitis Cohort</span></span>
<span><span class="va">targetCohort</span> <span class="op">&lt;-</span> <span class="va">cohortsGenerated</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohortName</span> <span class="op">==</span> <span class="st">"ViralSinusitis"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cohortId</span>, <span class="va">cohortName</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select everything BUT Viral Sinusitis cohorts</span></span>
<span><span class="va">eventCohorts</span> <span class="op">&lt;-</span> <span class="va">cohortsGenerated</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohortName</span> <span class="op">!=</span> <span class="st">"ViralSinusitis"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cohortId</span>, <span class="va">cohortName</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCohortSettings.html">createCohortSettings</a></span><span class="op">(</span></span>
<span>  targetCohorts <span class="op">=</span> <span class="va">targetCohort</span>,</span>
<span>  eventCohorts <span class="op">=</span> <span class="va">eventCohorts</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<strong>targetCohorts</strong>: A data.frame containing the
<code>Cohort ID</code> and <code>Cohort Name</code> of the target
cohorts</li>
<li>
<strong>eventCohorts</strong>: A data.frame containing the
<code>Cohort ID</code> and <code>Cohort Name</code> of the event
cohorts</li>
</ol>
</div>
<div class="section level3">
<h3 id="pathwaysettings">pathwaySettings<a class="anchor" aria-label="anchor" href="#pathwaysettings"></a>
</h3>
<p>The settings below are part of <code>pathwaySettings</code> and allow
the user to influence how the events of interest should be processed to
form treatment pathways. For the example in this vignette we used the
default settings</p>
<table class="table">
<colgroup>
<col width="22%">
<col width="27%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>param</th>
<th>values</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>studyName</td>
<td>default</td>
<td>Unique name identifying the set of study parameters below</td>
</tr>
<tr class="even">
<td>targetCohortId</td>
<td>1</td>
<td>Select one study population</td>
</tr>
<tr class="odd">
<td>eventCohortIds</td>
<td>10,11,12,13,14</td>
<td>Select all treatments of interest</td>
</tr>
<tr class="even">
<td>periodPriorToIndex</td>
<td>0</td>
<td>Number of days prior to the index date of the target cohort</td>
</tr>
<tr class="odd">
<td>minEraDuration</td>
<td>0</td>
<td>Minimum time an event era should last to be included in
analysis</td>
</tr>
<tr class="even">
<td>splitEventCohorts</td>
<td></td>
<td>Specify event cohort to split in acute (&lt; X days) and therapy
(&gt;= X days)</td>
</tr>
<tr class="odd">
<td>splitTime</td>
<td>30</td>
<td>Specify number of days (X) at which each of the split event cohorts
should be split in acute and therapy</td>
</tr>
<tr class="even">
<td>eraCollapseSize</td>
<td>30</td>
<td>Window of time between which two eras of the same event cohort are
collapsed into one era</td>
</tr>
<tr class="odd">
<td>combinationWindow</td>
<td>30</td>
<td>Window of time two event cohorts need to overlap to be considered a
combination treatment</td>
</tr>
<tr class="even">
<td>minPostCombinationDuration</td>
<td>30</td>
<td>Minimum time an event era before or after a generated combination
treatment should last to be included in analysis</td>
</tr>
<tr class="odd">
<td>filterTreatments</td>
<td>First</td>
<td>Select first occurrence of (‘First’) / changes between (‘Changes’) /
all event cohorts (‘All’)</td>
</tr>
<tr class="even">
<td>maxPathLength</td>
<td>5</td>
<td>Maximum number of steps included in treatment pathway</td>
</tr>
<tr class="odd">
<td>minCellCount</td>
<td>5</td>
<td>Minimum number of persons with a specific treatment pathway for the
pathway to be included in analysis</td>
</tr>
<tr class="even">
<td>minCellMethod</td>
<td>Remove</td>
<td>Select to completely remove / sequentially adjust (by removing last
step as often as necessary) treatment pathways below minCellCount</td>
</tr>
<tr class="odd">
<td>groupCombinations</td>
<td>10</td>
<td>Select to group all non-fixed combinations in one category ‘other’
in the sunburst plot</td>
</tr>
<tr class="even">
<td>addNoPaths</td>
<td>FALSE</td>
<td>Select to include untreated persons without treatment pathway in the
sunburst plot</td>
</tr>
</tbody>
</table>
<div class="figure">
<img src="../reference/figures/pathwaysettings.png" alt=""><p class="caption">pathwaySettings</p>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pathwaySettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createPathwaySettings.html">createPathwaySettings</a></span><span class="op">(</span></span>
<span>  cohortSettings <span class="op">=</span> <span class="va">cohortSettings</span>,</span>
<span>  studyName <span class="op">=</span> <span class="st">"Viral_Sinusitis"</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<strong>cohortSettings</strong>: The <code>cohortSettings</code>
object created by <code>createCohortSettings</code>
</li>
<li>
<strong>studyName</strong>: A character string specifying the name
of the study.</li>
<li>
<strong>…</strong>: Any of the settings metioned above, except
targetCohortId and eventCohortId.</li>
</ol>
</div>
<div class="section level3">
<h3 id="addpathwaysettings">addPathwaySettings<a class="anchor" aria-label="anchor" href="#addpathwaysettings"></a>
</h3>
<p>Optionally we can add another pathway analysis. Lets say for our
analysis we want the following:</p>
<ol style="list-style-type: decimal">
<li>Make sure that the duration of an era is at least 2 weeks.</li>
<li>Make sure two events of the same treatment may be 3 weeks
apart.</li>
<li>But if two eras overlap only 1 week they will be considered one
era.</li>
<li>Consider only pathways that at least have 5 people represented in
them.</li>
<li>Set the cut off to group combination treatments in ‘other’ to
5.</li>
<li>And most importantly we must name our study.</li>
</ol>
<p>In this example we will change some of the settings:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pathwaySettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addPathwayAnalysis.html">addPathwayAnalysis</a></span><span class="op">(</span></span>
<span>  pathwaySettings <span class="op">=</span> <span class="va">pathwaySettings</span>,</span>
<span>  targetCohortIds <span class="op">=</span> <span class="va">targetCohort</span><span class="op">$</span><span class="va">cohortId</span>,</span>
<span>  eventCohortIds <span class="op">=</span> <span class="va">eventCohorts</span><span class="op">$</span><span class="va">cohortId</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="co"># 6. Name of are new study</span></span>
<span>  studyName <span class="op">=</span> <span class="st">"someOtherCoolParameters"</span>,</span>
<span>  <span class="co"># 1. Minimum duration of 14 days.</span></span>
<span>  minEraDuration <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  <span class="co"># 2. Collapse two eras if they are 21 days apart.</span></span>
<span>  eraCollapseSize <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  <span class="co"># 3. 7 day overlap between eras</span></span>
<span>  combinationWindow <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  <span class="co"># 4. At least 5 persons</span></span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  <span class="co"># 5. nPathway =&lt; 5 -&gt; Other</span></span>
<span>  groupCombinations <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<strong>pathwaySettings</strong>: The <code>pathwaySettings</code>
object created by <code>cratePathwaySettings</code>.</li>
<li>
<strong>targetCohortIds</strong>: The Target Cohort IDs</li>
<li>
<strong>eventCohortIds</strong>: The Event Cohort IDs you’d like to
include</li>
<li>
<strong>…</strong>: Any other parameter you’d liek to change. A full
list of parameters can be found in the <code>addPathwaySettings</code>
documentation. <strong>Some</strong> of these parameters are: studyName,
minEraDuration, combinationWindow, eraCollapseSize, maxPathLength.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="constructing-pathways-and-reviewing-output">Constructing pathways and reviewing output<a class="anchor" aria-label="anchor" href="#constructing-pathways-and-reviewing-output"></a>
</h2>
<div class="section level3">
<h3 id="writecohorttable">writeCohortTable<a class="anchor" aria-label="anchor" href="#writecohorttable"></a>
</h3>
<p>writeCohortTable writes the cohort table and the cohortsToCreate
table to our output folder</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeCohortTable.html">writeCohortTable</a></span><span class="op">(</span></span>
<span>  saveSettings <span class="op">=</span> <span class="va">saveSettings</span>,</span>
<span>  cohortSettings <span class="op">=</span> <span class="va">cohortSettings</span>,</span>
<span>  dataSettings <span class="op">=</span> <span class="va">dataSettings</span>,</span>
<span>  tableName <span class="op">=</span> <span class="va">cohortTable</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<strong>saveSettings</strong>: <code>saveSettings</code>
object.</li>
<li>
<strong>cohortSettings</strong>: <code>cohortSettings</code>
object.</li>
<li>
<strong>dataSettings</strong>: <code>dataSettings</code>
object.</li>
<li>
<strong>tableName</strong>: Table name of the cohort table in the
database.</li>
</ol>
</div>
<div class="section level3">
<h3 id="constructpathways">constructPathways<a class="anchor" aria-label="anchor" href="#constructpathways"></a>
</h3>
<p>After our settings are specified we can construct our pathways.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/constructPathways.html">constructPathways</a></span><span class="op">(</span></span>
<span>  dataSettings <span class="op">=</span> <span class="va">dataSettings</span>,</span>
<span>  pathwaySettings <span class="op">=</span> <span class="va">pathwaySettings</span>,</span>
<span>  saveSettings <span class="op">=</span> <span class="va">saveSettings</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<strong>dataSettings</strong>: <code>dataSettings</code>
object.</li>
<li>
<strong>pathwaySettings</strong>: <code>pathwaySettings</code>
object.</li>
<li>
<strong>saveSettings</strong>: <code>saveSettings</code>
object.f</li>
</ol>
</div>
<div class="section level3">
<h3 id="generateoutput">generateOutput<a class="anchor" aria-label="anchor" href="#generateoutput"></a>
</h3>
<p>After our pathways are computed, we can generate our output
files.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generateOutput.html">generateOutput</a></span><span class="op">(</span>saveSettings <span class="op">=</span> <span class="va">saveSettings</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Zipping: D:\Users\mvankessel\Documents\R-Packages\TreatmentPatterns\vignettes\output</span></span>
<span><span class="co">## to: C:\Users\mvankessel\AppData\Local\Temp\RtmpwhVZGn\output.zip</span></span></code></pre>
<ol style="list-style-type: decimal">
<li>
<strong>saveSettings</strong>: <code>saveSettings</code>
object.</li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maarten van Kessel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
